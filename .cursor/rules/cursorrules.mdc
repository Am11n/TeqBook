---
name: cursorrules
description: This is a new rule
---

# Overview

# TeqBook Cursor Rules

## Admin App – Page Structure

Every page inside `apps/admin/src/app/(admin)/` MUST follow this exact pattern:

```tsx
<ErrorBoundary>
  <AdminShell>
    <PageLayout title="..." description="..." actions={...}>
      {/* page content */}
    </PageLayout>
  </AdminShell>
</ErrorBoundary>
```

### Critical: DashboardShell admin route bypass

`PageLayout` internally wraps content in `DashboardShell`. For admin pages, `DashboardShell` has a bypass list that makes it pass children through without rendering the dashboard sidebar/header.

**When you create a new admin page, you MUST add its route to the `adminRoutes` array in `apps/admin/src/components/layout/dashboard-shell.tsx`.**

If you forget this step, the page will render with BOTH the admin sidebar AND the dashboard sidebar (nested shells).

File: `apps/admin/src/components/layout/dashboard-shell.tsx`
Look for:
```ts
const adminRoutes = [
  "/", "/login",
  "/salons", "/users", ...
];
```

Add your new route there.

## UI Styling

- Buttons for primary actions use `variant="default"` (NOT `variant="outline"` or `variant="primary"`).
- Never put icons inside table cells/columns unless explicitly asked.
- The admin app uses Tailwind v4. Shared UI packages are scanned via `@source` directives in `globals.css`.

## Dialogs / Modals

**ALL dialogs and modals MUST use the Radix `Dialog` component** from `@/components/ui/dialog`. Never create custom modal wrappers with `fixed inset-0` or side-panel slide-ins. Every dialog must follow this exact pattern:

```tsx
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";

// Props: open: boolean, onOpenChange: (open: boolean) => void
<Dialog open={open} onOpenChange={onOpenChange}>
  <DialogContent className="max-w-md">
    <DialogHeader>
      <DialogTitle>Title</DialogTitle>
      <DialogDescription>Description</DialogDescription>
    </DialogHeader>

    {/* Content / form */}

    <DialogFooter>
      <Button variant="outline" onClick={() => onOpenChange(false)}>Cancel</Button>
      <Button type="submit">Confirm</Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

**Key rules:**
- Use `open` / `onOpenChange` props (controlled) — never uncontrolled.
- Use `DialogContent className="max-w-md"` (or `max-w-lg` for larger forms). Never full-screen or side-panel.
- Use `DialogHeader` with `DialogTitle` and optional `DialogDescription`.
- Use `DialogFooter` for action buttons.
- For scrollable content inside a dialog, wrap the body in `<div className="max-h-[60vh] overflow-y-auto">`.
- The `DialogContent` component already provides: backdrop, close button (X), centered positioning, zoom animation, and Escape-to-close.

Reference implementation: `apps/dashboard/src/components/bookings/CreateBookingDialog.tsx`.

## Dropdowns inside Dialogs

**ALWAYS use native `<select>` elements for dropdowns inside Dialog boxes.** Never use the Radix `Select` component (`SelectTrigger` / `SelectContent` / `SelectItem`) inside a `Dialog`. Radix Select portals its dropdown to `<body>`, causing z-index conflicts with the Dialog overlay — the options become invisible.

Use this pattern (same as `BookingForm.tsx`):

```tsx
<select
  id="my-field"
  value={value}
  onChange={(e) => setValue(e.target.value)}
  required
  className="h-9 w-full rounded-md border border-input bg-background px-2 text-sm outline-none ring-ring/0 transition focus-visible:ring-2"
>
  <option value="">Placeholder...</option>
  {items.map((item) => (
    <option key={item.id} value={item.id}>{item.name}</option>
  ))}
</select>
```

The Radix `Select` component is fine on regular pages (outside Dialogs).

## Auth / Cookie Isolation

- The **admin app** uses a custom cookie name `sb-admin-auth-token` (set in `apps/admin/src/lib/supabase/client.ts` and `server.ts`).
- The **dashboard app** and **public app** use the default Supabase cookie name (no custom name).
- The **`/login-admin`** page on the public app creates its own Supabase client with the admin cookie name so the session is readable by the admin app.
- Never change the dashboard cookie name to something custom — it must match the public app (default) so the login → redirect flow works.

## Sidebar Navigation

- The sidebar uses a "longest prefix match" algorithm for active state. When adding new nav items, ensure the `href` values don't cause multiple items to highlight. See `admin-shell.tsx` for the `activeHref` logic.

## DataTable Sorting

- `DataTable` always applies client-side sorting.
- For computed columns (e.g. "status" derived from `is_public`), use the `getValue` property on `ColumnDef` so sorting works correctly.
- The prop for sort column is `sortColumn` (NOT `sortBy`).

## Supabase / Backend

- Admin API routes that need Supabase should import from `@/lib/supabase/server` (NOT from `@teqbook/shared/supabase/server-client` directly).
- The admin app uses `trailingSlash: true` in `next.config.ts`. When fetching internal API routes client-side, always include the trailing slash (e.g. `fetch("/api/health/")`).

## Weekday Numbering Convention

The codebase uses Monday-first weeks everywhere in the UI. Two different numbering systems exist in the database:

- **opening_hours.day_of_week**: 0=Monday, 1=Tuesday, ..., 6=Sunday (set by onboarding, see `onboarding-utils.ts`)
- **shifts.weekday**: 0=Sunday, 1=Monday, ..., 6=Saturday (JS `Date.getDay()` convention)

**Rules:**
- All week views (calendar, shifts, opening hours) MUST start on Monday.
- When reading opening hours, use the helpers in `useOpeningHoursForShifts.ts` which accept JS weekday (`getDay()`: 0=Sun, 1=Mon, ..., 6=Sat) and convert to the OH convention internally.
- Never assume 0=Sunday or 0=Monday without checking which table you are reading from.
- The pattern editor in `CopyShiftsDialog` uses ISO weekdays internally (1=Monday, 7=Sunday).
- When converting ISO weekday to JS: `jsDay = isoDay === 7 ? 0 : isoDay`
- When converting JS to OH: `ohDay = jsDay === 0 ? 6 : jsDay - 1` (handled by `jsWeekdayToOH` in the hook)

## General

- Always check for linter errors after editing files.
- Never commit `.env` files or secrets.
- Use `useSearchParams()` only inside a `<Suspense>` boundary to avoid prerendering errors.
