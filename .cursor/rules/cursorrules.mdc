---
name: cursorrules
description: This is a new rule
---

# TeqBook Cursor Rules

## Package Architecture

The monorepo has shared packages and thin app shells:

| Package | Purpose |
|---|---|
| `@teqbook/ui` | Radix primitives, `cn()`, design tokens |
| `@teqbook/layout` | PageHeader, NavLink, SessionTimeoutDialog |
| `@teqbook/feedback` | ErrorBoundary, ErrorMessage, EmptyState |
| `@teqbook/data-table` | DataTable, DataTableToolbar, Pagination, types, hooks |
| `@teqbook/page` | ListPage, TabbedPage, PageLayout, StatsBar, FilterChips, TabToolbar, Action model |
| `@teqbook/shared-core` | Pure types, utils, constants (no Supabase) |
| `@teqbook/shared-data` | Supabase clients, auth contract, rate limiting |

**Apps are shells**: `dashboard`, `admin`, `public` own routing, shell chrome, and access control. All reusable logic lives in packages.

## Import Rules

- Import from package root only: `import { ListPage } from "@teqbook/page"` -- never deep imports like `@teqbook/page/components/list-page`
- No cross-app imports: dashboard cannot import from admin or vice versa
- UI primitives: always from `@teqbook/ui`, never from `@/components/ui/*` in new code
- `cn()`: from `@teqbook/ui`, not from `@/lib/utils`

## Page Structure

### List pages (CRUD)

Use `ListPage` from `@teqbook/page`:

```tsx
<ErrorBoundary>
  <ListPage
    title="..."
    description="..."
    actions={[
      { label: "Secondary", onClick: ..., variant: "outline", priority: "secondary" },
      { label: "Primary", onClick: ..., priority: "primary" },
    ]}
    stats={statsItems}
    filterChips={filterChips}
    activeFilters={activeFilters}
    onFiltersChange={setActiveFilters}
    state={pageState}
    banner={<AppSpecificBanners />}
  >
    <CustomTableOrContent />
  </ListPage>
</ErrorBoundary>
```

### Tabbed pages

Use `TabbedPage` from `@teqbook/page`:

```tsx
<DashboardShell>
  <TabbedPage
    title="..."
    description="..."
    tabs={tabs}
    guardEnabled={needsDirtyGuard}
    usePathname={usePathname}
    useRouter={useRouter}
  >
    {children}
  </TabbedPage>
</DashboardShell>
```

### Admin pages

Wrap in `AdminShell`:

```tsx
<ErrorBoundary>
  <AdminShell>
    <ListPage title="..." state={pageState} actions={[...]}>
      {/* content */}
    </ListPage>
  </AdminShell>
</ErrorBoundary>
```

## Action Model

All page actions use the `PageAction` type from `@teqbook/page`:

- **Primary action**: always far right, always `priority: "primary"`
- **Secondary actions**: to the left, `priority: "secondary"`, `variant: "outline"`
- **Row actions**: always kebab menu (MoreVertical), never inline buttons in cells
- **Bulk actions**: always in a selection bar below the toolbar

## Component Creation Gate

- NEVER create a new component file without first:
  1. Searching `docs/component-registry.md` for an existing match
  2. Searching `packages/` for similar components
  3. Checking if an existing component can be extended with a new prop
  4. If nothing fits: write a New Component Proposal (format in `docs/build-gate.md`) and ASK THE USER for approval before writing any code

- Extending an existing component is ALWAYS preferred over creating a new one
- New reusable components MUST live in `packages/`, never in `apps/`
- App components are page-specific only; if usable in 2+ places, it belongs in a package
- Every new public component MUST be added to `docs/component-registry.md`
- New public components MUST use `@teqbook/ui` tokens; no hardcoded spacing/colors

## UI Styling

- Buttons for primary actions use `variant="default"` (NOT `variant="outline"` or `variant="primary"`).
- Never put icons inside table cells/columns unless explicitly asked.
- The admin app uses Tailwind v4. Shared UI packages are scanned via `@source` directives in `globals.css`.

## Dialogs / Modals

**ALL dialogs and modals MUST use the Radix `Dialog` component** from `@teqbook/ui`. Never create custom modal wrappers with `fixed inset-0` or side-panel slide-ins. Every dialog must follow this exact pattern:

```tsx
import {
  Dialog, DialogContent, DialogDescription, DialogFooter,
  DialogHeader, DialogTitle,
} from "@teqbook/ui";

<Dialog open={open} onOpenChange={onOpenChange}>
  <DialogContent className="max-w-md">
    <DialogHeader>
      <DialogTitle>Title</DialogTitle>
      <DialogDescription>Description</DialogDescription>
    </DialogHeader>
    {/* Content / form */}
    <DialogFooter>
      <Button variant="outline" onClick={() => onOpenChange(false)}>Cancel</Button>
      <Button type="submit">Confirm</Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

**Key rules:**
- Use `open` / `onOpenChange` props (controlled) -- never uncontrolled.
- Use `DialogContent className="max-w-md"` (or `max-w-lg` for larger forms). Never full-screen or side-panel.
- For scrollable content inside a dialog, wrap the body in `<div className="max-h-[60vh] overflow-y-auto">`.

## Dropdowns inside Dialogs

**ALWAYS use native `<select>` elements for dropdowns inside Dialog boxes.** Never use the Radix `Select` component inside a `Dialog`. Radix Select portals its dropdown to `<body>`, causing z-index conflicts with the Dialog overlay.

## Auth / Cookie Isolation

- The **admin app** uses a custom cookie name `sb-admin-auth-token`.
- The **dashboard app** and **public app** use the default Supabase cookie name.
- Never change the dashboard cookie name to something custom.

## Sidebar Navigation

- The sidebar uses a "longest prefix match" algorithm for active state. When adding new nav items, ensure the `href` values don't cause multiple items to highlight.

## DataTable

- Use `DataTable` from `@teqbook/data-table` (not from `@/components/shared/data-table`).
- Client-side sorting is the default. For computed columns, use `getValue` on `ColumnDef`.
- The prop for sort column is `sortColumn` (NOT `sortBy`).
- For mobile responsiveness, use the `mobileRow` contract on `DataTableProps`.

## Supabase / Backend

- Admin API routes that need Supabase should import from `@/lib/supabase/server`.
- The admin app uses `trailingSlash: true` in `next.config.ts`. Always include trailing slashes in API routes.

## Weekday Numbering Convention

- **opening_hours.day_of_week**: 0=Monday, ..., 6=Sunday
- **shifts.weekday**: 0=Sunday, 1=Monday, ..., 6=Saturday (JS `Date.getDay()`)
- All week views MUST start on Monday.
- Never assume 0=Sunday or 0=Monday without checking which table you are reading from.

## General

- Always check for linter errors after editing files.
- Never commit `.env` files or secrets.
- Use `useSearchParams()` only inside a `<Suspense>` boundary to avoid prerendering errors.
